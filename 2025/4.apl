data ← ↑⊃⎕NGET'4.txt'1

⍝ Part 1
+/,{'@'≠5⊃,⍵:0 ⋄ 4>+/'@'=1↓4⌽,⍵}⌺3 3⊢data

⍝ Part 2
remove ← {n ← ⍸{'@'≠5⊃,⍵:0 ⋄ 4>+/'@'=1↓4⌽,⍵}⌺3 3⊢⍵ ⋄ 0=≢n:⍺ ⋄ w ← ('.'@n)⍵ ⋄ (⍺+≢n)∇w}
0 remove data
